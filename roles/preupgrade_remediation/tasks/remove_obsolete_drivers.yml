---
- name: Blacklisting floppy in modprobe
  ansible.builtin.shell: echo "blacklist floppy" | sudo tee /etc/modprobe.d/blacklist-floppy.conf
  register: floppy_blacklist_status
  changed_when: floppy_blacklist_status.rc == 0

- name: Blacklisting pata_acpi in modprobe
  ansible.builtin.shell: echo "blacklist pata_acpi" | sudo tee /etc/modprobe.d/blacklist-pata_acpi.conf
  register: pata_acpi_blacklist_status
  changed_when: pata_acpi_blacklist_status.rc == 0

#- name: Removing floppy driver
#  ansible.builtin.shell: rmmod floppy
  
#- name: Removing pata_acpi
#  ansible.builtin.shell: rmmod pata_acpi

- name: Removing obsolete kernel drivers
  community.general.modprobe:
    name: "{{ item }}"
    state: absent
  loop: "{{ obsolete_kernel_drivers }}"

- name: Running dracut
  ansible.builtin.shell: dracut -f -v